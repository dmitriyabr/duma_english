# Сравнение: исследование «Скорость прироста мастерства» vs наша реализация

Ссылка на исследование: `Скорость прироста мастерства в языковых графах знаний.md` (корень проекта).

## 1. Рекомендации исследования (кратко)

| Рекомендация | Суть |
|--------------|------|
| **Модель** | EMA с α ≈ 0.8 и порог мастерства T = 0.95; ~14 правильных подряд для 100%. Ошибки не обнуляют прогресс. |
| **Пороги визуализации** | Промежуточные уровни: 50%, 80%, 95% (как umimecesky.cz) для мотивации. |
| **Время между ответами** | Учитывать распределённую практику: правильное использование через день/неделю/месяц надёжнее, чем 10 раз за сессию. 85% удержания при распределённой практике vs 22% при зубрёжке. |
| **Не присваивать 100% слишком быстро** | Для продуктивного знания слова — минимум 10–12 встреч; для долгосрочного удержания — 20–30 распределённых. |
| **Распад (decay)** | Сила слова должна снижаться со временем без практики (как HLR Duolingo). Критично для лексики. |
| **N подряд правильных (NCC)** | 3–5 для лёгких элементов, 8–15 для сложных; для BKT-сценариев 2–8. Высокая корреляция решений NCC и BKT. |
| **Шкала баллов (ориентир)** | 1 прав. → 15–25; 3 подряд → 40–50; 5 в разных контекстах → 60–70; 8–10 с интервалами → 80–90; 12–15 распределённых → 95–100. Без практики 2+ недели: −10–20 п.п. |

---

## 2. Наш подход (текущая реализация)

| Аспект | У нас |
|--------|--------|
| **Модель** | Байесовский posterior: α, β обновляются как α += w×score, β += w×(1−score). Value = 100×α/(α+β). Не EMA, но поведение похоже: ошибки не обнуляют, а снижают среднее. |
| **Порог «мастерство»** | **70** (не 95) для «closed» ноды и продвижения по бандлам. 95% у нас не используется. |
| **Визуализация** | Прогресс-бар по бандлам + value progress (min(value,70)/70). Промежуточные уровни по сути есть (0–100), но явных порогов 50/80/95 в логике нет. |
| **Скорость выхода на порог** | Cap α+β = **12** → каждый evidence даёт заметный сдвиг; до 70 реально за **15–25** повторений (в духе 10–12 встреч для продуктивного знания). |
| **Распад** | **Есть.** decayedMastery = mean × exp(−ln(2)×days/halfLife). Half-life: vocab 14 дней, grammar 21; effective half-life растёт с числом доказательств и reliability. |
| **N-CCR** | **2** прямых успеха подряд (direct, score ≥ 0.7) → **verified** даже при mean < 70. Исследование допускает 2–8 для BKT — мы в диапазоне. |
| **Streak** | 2-й успех подряд ×1.25, 3-й ×1.56, 4+ ×1.8. Ускоряет рост при стабильном успехе. |
| **PFA** | score ≥ 0.6 → вес ×1.1, score < 0.4 → ×0.9. Соответствует идее «правильно — быстрее, ошибки — медленнее». |
| **Время между ответами** | **Учитывается только через decay.** В формулу прироста (α, β) интервал между доказательствами не входит — все evidence одинаковы по «давности» в рамках одной попытки. Распределённая практика не даёт бонуса к весу. |
| **Типы evidence** | Direct (явная цель задания) и supporting (инцидентальное использование). Один baseWeight = 1; разница в conf/rel. Большинство доказательств в реальных профилях — supporting+incidental, direct мало. |

---

## 3. Насколько подходы отличаются

### Совпадает с исследованием

- **Ошибки не обнуляют прогресс** — у нас Beta posterior, ошибка увеличивает β и снижает value, но не сбрасывает.
- **Распад мастерства** — реализован (decayedMastery, half-life по типу ноды и evidence count).
- **N-CCR** — 2 подряд для ранней верификации в допустимом диапазоне (2–8).
- **Ускорение при правильных / замедление при ошибках** — PFA и streak в весе.
- **Ориентир по числу встреч** — 15–25 повторений до «закрытия» (70) близко к 10–12 встречам для продуктивного знания; мы не даём 100% после 3 ответов.

### Отличия

| Тема | Исследование | У нас | Риск |
|------|---------------|--------|------|
| **Порог мастерства** | 0.95 (95%) | 70 (70%) | «Мастерство» объявляется раньше; при желании строже — поднять порог или ввести второй (например 95 для «gold»). |
| **Учёт распределённой практики** | Интервалы между ответами повышают надёжность; 20–30 распределённых для долгосрочного удержания | Интервал не входит в вес evidence; только decay после последнего доказательства | Распределённые доказательства не получают бонуса; «10 раз за сессию» и «10 раз с интервалами» влияют одинаково на mean (но по-разному на decay и half-life). |
| **Промежуточные пороги** | 50%, 80%, 95% как явные уровни для мотивации | Один порог 70 для closed; шкала 0–100 без явных ступенек | Можно добавить явные метки (50/80/95) в UI и в объяснениях прогресса. |
| **Количество встреч до «мастерства»** | 10–12 минимум для продуктивного, 12–15 до 95–100 | 15–25 до 70 при cap 12 | Мы чуть консервативнее по числу шагов до порога — ок. |
| **Repeated supporting** | Многократное правильное использование в контексте должно укреплять оценку | В MASTERY_METHODOLOGY описан boost ×1.5 после 5+ supporting, в коде **не реализован** (supportingEvidenceCount не используется для множителя веса) | Ноды с множеством supporting (например 35× «play») растут так же, как после 1–2; медленный рост при редком direct. |

---

## 4. Как улучшить флоу (конкретные шаги)

### 4.1 Реализовать repeated supporting boost (высокий приоритет)

**Проблема:** Исследование и лингвистика: многократное осмысленное использование слова укрепляет знание. У нас большинство evidence — supporting+incidental; без бонуса рост до 70 долгий и стрик почти не срабатывает.

**Действие:** В `applyEvidenceToStudentMastery` после вычисления `effectiveWeight`: если `kind === "supporting"` и `opportunity === "incidental"` и `evidence.targeted === false` и уже есть `(existing?.supportingEvidenceCount ?? 0) >= 5` и `score >= 0.6`, умножить вес на **1.5** (или вынести в константу). Уже описано в MASTERY_METHODOLOGY как «Done» — в коде пока нет; добавить и синхронизировать док.

**Ожидание:** 6-е, 7-е, … supporting-доказательства по одной ноде будут заметнее поднимать value, ближе к «8–12 осмысленных встреч» без требования множества direct.

### 4.2 Учёт распределённой практики (средний приоритет)

**Проблема:** Исследование: распределённая практика даёт гораздо лучшее удержание. Сейчас интервал между доказательствами влияет только на decay, не на «качество» нового evidence.

**Варианты (без ломки контракта):**

- **A) Бонус к весу за давность последнего evidence:** если `daysSinceLastEvidence >= 1` (или 3, 7), умножить effectiveWeight на коэффициент > 1 (например 1.1 за день, cap 1.3). Тогда доказательства «после паузы» чуть сильнее поднимают мастерство.
- **B) Увеличить effective half-life при большом числе доказательств** — уже есть (repetitionBoost в `effectiveHalfLifeDays`). Можно чуть усилить, чтобы при 10+ evidence распад был медленнее и «распределённость» сохранялась дольше.

Начать с A в виде опционального множителя и замерить на реальных профилях.

### 4.3 Явные пороги прогресса 50 / 80 / 95 (низкий приоритет, UI/продукт)

**Проблема:** Исследование рекомендует визуализировать ступени (50%, 80%, 95%) для мотивации.

**Действие:** На уровне продукта/API: считать и отдавать не только value, но и «уровень» по порогам (например `progressLevel: "forming" | "confident" | "stable" | "mastered"` при 50/80/95/100 или при 50/70/95). Полоску и тексты подписывать под эти уровни. Логику мастерства (70 для closed) можно не менять — это про отображение и формулировки.

### 4.4 Опционально: порог «полного» мастерства 95

**Проблема:** В исследовании порог мастерства 0.95; у нас «closed» при 70.

**Действие:** Оставить 70 для продвижения по бандлам и «path to next level». При желании ввести второй порог 95 для метки «gold» / «полное мастерство» только в UI и аналитике, без изменения правил promotion. Не обязательно менять расчёты в mastery.ts.

### 4.5 Документация и TASKS

- В **MASTERY_METHODOLOGY.md** явно указать: repeated supporting boost ×1.5 после 5+ supporting — либо «реализовано» с указанием места в коде, либо «запланировано» и вынести в TASKS.
- В **TASKS.MD** в раздел «Immediate Next Steps» или «Sprint» добавить пункт: «Repeated supporting boost в mastery (×1.5 после 5+ supporting, score ≥ 0.6)» и при желании «Бонус к весу за распределённую практику (давность last evidence)».

---

## 5. Итог

- **Подходы в целом согласованы:** байесовский posterior вместо EMA даёт похожее поведение; decay и N-CCR соответствуют литературе; порог 70 мягче, чем 95, но число встреч до «закрытия» в разумном диапазоне.
- **Главные расхождения:** (1) нет учёта распределённой практики в весе evidence; (2) нет repeated supporting boost в коде при том, что он описан в методологии; (3) нет явных порогов 50/80/95 в продукте.
- **Самое полезное улучшение флоу** — реализовать repeated supporting boost и при желании добавить лёгкий бонус за давность последнего evidence, затем при необходимости ввести явные уровни прогресса в UI.
